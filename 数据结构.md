# data.db
Table: User [结构]
| 字段名 | 类型 | 说明 |	备注 |
| :---: | :---: | :---: | :---: |
| ID | int | 用户 ID | 主键，自增 |
| Name | varchar(32) | 用户名 | 唯一，非空 |
| Nick | varchar(32) | 昵称 |  |
| Hash | blob | 密码哈希 | 非空，64字节 |
| Salt | blob | 密码盐 | 非空，16字节 |

Table: AppInfo [信息]
| 键 | 实际应用类型 | 说明 | 备注 |
| :---: | :---: | :---: | :---: |
| Version | Version | 版本号 | 用于比对应用程序版本 |


# Session 信息
|  键  | 实际应用类型 |  说明  | 备注 |
| :--: | :---------: | :----: | :--: |
| Name |   string    | 用户名 |      |
| Nick |   string    |  昵称  |      |
| Hash |    blob     |密码哈希|      |
| Salt |    blob     | 密码盐 |      |



# API 代码
| Code |            说明            | Success |
| :--: | :------------------------: |:-------:|
|  0   |            成功            |  true   |
|  1   | 已经完成过相应操作，视为成功 |  true   |
|  2   | 已经完成过相应操作，视为失败 |  false  |
|  3   |  不满足前置条件，如未登录   |  false  |
|  4   |          需要 sudo         |  false  |
|  5   |       参数缺失或错误        |  false  |
|  6   |    验证失败，如密码错误     |  false  |
|  7   |        超出次数限制        |  false  |


# ChatHub MessagePack
| 方向 |    命令    |     参数0     |    参数1    |           参数2           |  参数3   |      说明      |         备注         |
| :--: | :-------: | :-----------: | :---------: | :-----------------------: | :------: | :-----------: | :------------------: |
| C->S |  `group`  |`create` `join`|  `<name>`   |`<password (can be empty)>`| `<echo>` | 创建或加入群组 |                      |
| C->S |  `group`  |    `leave`    |  `<echo>`   |                           |          | 离开群组       |                      |
| C->S | `message` |  `<message>`  |  `<echo>`   |                           |          | 发送消息       |                      |
| S->C |  `group`  |   `success`   | `<message>` |         `<echo>`          |          | 群组操作成功   |                      |
| S->C |  `group`  |    `error`    | `<message>` |         `<echo>`          |          | 群组操作失败   | 一般用于密码错误      |
| S->C |  `group`  |   `failed`    | `<message>` |         `<echo>`          |          | 群组操作失败   | 一般用于已存在、不存在 |
| S->C | `message` |  `<sender>`   | `<message>` |         `<time>`          | `<echo>` | 消息           |                      |
| S->C | `notice`  |   `<title>`   | `<message>` |         `<icon>`          | `<echo>` | 通知           |                      |
| S->C | `notice`  |`<swalParams>` |  `<echo>`   |                           |          | 通知           | 自定义参数           |